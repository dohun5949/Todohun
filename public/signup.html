<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>todoList - 회원가입</title>
    <style>
        body {
            margin: 0;
            height: 100vh;
        }

        nav {
            height: 60px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid #ccc;
        }

        main {
            height: calc(100vh - 60px);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #signupDiv {
            border: 1px solid #ccc;
            padding: 20px;
            width: 410px;
            transform: translateY(-80px);
        }

        #signupDiv h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .row label {
            width: 120px;
        }

        .row input {
            margin-left: 20px;
            width: 180px;
        }

        .unique {
            margin-left: 10px;
            padding: 2px 6px;
            font-size: 0.8em;
            height: 26px;
            cursor: pointer;
        }

        #button {
            width: 100%;
            margin-top: 10px;
            padding: 6px;
        }

        #row-links {
            display: flex;
            align-items: center;
            font-size: 0.9em;
            margin-top: 10px;
        }

        #row-links a:first-child {
            margin-right: auto;
        }

        #find {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        a {
            text-decoration: none;
            color: black;
        }
    </style>
</head>

<body>
    <nav>
        <a href="main.html">todolist</a>
    </nav>

    <main>
        <div id="signupDiv">
            <h2>SIGN UP</h2>

            <form method="post" id="signup">
                <div class="row">
                    <label>아이디</label>
                    <input type="text" name="login_id" placeholder="아이디 입력">
                    <button type="button" class="unique" onclick=test()>중복 확인</button>
                </div>

                <div class="row">
                    <label>비밀번호</label>
                    <input type="password" name="pwd" placeholder="비밀번호 입력">
                </div>

                <div class="row">
                    <label>비밀번호 확인</label>
                    <input type="password" name="pwd_check" placeholder="비밀번호 확인">
                </div>

                <div class="row">
                    <label>이름</label>
                    <input type="text" name="name" placeholder="이름 입력">
                </div>
                <div class="row">
                    <label>닉네임</label>
                    <input type="text" name="nickname" placeholder="닉네임 입력">
                </div>
                <div class="row">
                    <label>전화번호</label>
                    <input type="text" name="phone" placeholder="01012345678">
                </div>

                <div class="row">
                    <label>이메일</label>
                    <input type="email" name="email" placeholder="example@email.com">
                </div>

                <div class="row">
                    <label>생년월일</label>
                    <input type="date" name="birth">
                </div>

                <button id="button" type="submit">회원가입</button>

                <div id="row-links">
                    <a href="login.html">로그인</a>
                    <div id="find">
                        <a href="find_id.html">아이디 찾기</a>
                        <span>|</span>
                        <a href="find_pwd.html">비밀번호 찾기</a>
                    </div>
                </div>
            </form>
        </div>
    </main>
    <script>
        document.getElementById("signup").addEventListener("submit", async function (e) {
            e.preventDefault();
            const form = new FormData(this);
            const data = Object.fromEntries(form.entries());

            const res = await fetch("/user/signup", {
                method: "post",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            });
            if (res.ok) {
                alert("회원가입 완료");
                location.href = "login.html"
            } else {
                const msg = await res.text();
                alert(msg);
            }
        });
        async function test() {
            const input = document.querySelector('input[name = "login_id"]');
            const login_id = input.value.trim();

            if (login_id === "") {
                alert("아이디를 입력하세요");
                input.focus();
                return;
            }
            const res = await fetch("/user/unique", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ login_id })
            });
            const msg = await res.text();
            if(res.ok){
                alert("사용 가능한 아이디입니다.");
            }else{
                alert(msg);
            }
        }
    </script>
</body>

</html>